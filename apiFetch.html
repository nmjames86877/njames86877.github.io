<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Fetch and Excel Update</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
</head>
<body>
    <button id="fetchDataBtn">Fetch Data and Update Excel</button>
    <p id="resultMessage"></p>
    <script>
        document.getElementById('fetchDataBtn').addEventListener('click', fetchData);

        function fetchData() {
            fetch('https://www.consumerfinance.gov/data-research/consumer-complaints/search/api/v1/?date_received_min=2024-12-01')
                .then(response => response.json())
                .then(data => {
                    const complaints = data.hits.hits.map(item => item._source);
                    updateExcelFile(complaints);
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                    document.getElementById('resultMessage').textContent = 'Error fetching data.';
                });
        }

        function updateExcelFile(data) {
            fetch('https://1drv.ms/x/c/cd6cbe893ea13b4b/ESYZkMUoEExHoJphONk86wYBGF-PvDlRZbm-UBhsJm0QBg')
                .then(response => response.arrayBuffer())
                .then(arrayBuffer => {
                    const workbook = XLSX.read(arrayBuffer, {type: 'array'});
                    const worksheet = workbook.Complaints[workbook.SheetNames[0]];

                    XLSX.utils.sheet_add_json(worksheet, data, {origin: -1, skipHeader: true});

                    XLSX.writeFile(workbook, 'complaints.xlsx');
                    document.getElementById('resultMessage').textContent = 'Excel file updated successfully.';
                })
                .catch(error => {
                    console.error('Error updating Excel file:', error);
                    document.getElementById('resultMessage').textContent = 'Error updating Excel file.';
                });
        }
    </script>
</body>
</html>